<style>
  .fanekena-container { height: 100%; background: white; }
  
  /* Panel Liste */
  .fanekena-list-panel { 
      background: #F7F7F5; 
      border-right: 1px solid #e1e1e1; 
      display: flex; flex-direction: column; height: 100%; 
  }
  
  /* Panel Editeur */
  .fanekena-editor-panel { 
      background: white; 
      display: flex; flex-direction: column; height: 100%; 
      position: relative;
  }
  
  .list-item-f { padding: 12px 15px; border-bottom: 1px solid #e1e1e1; cursor: pointer; transition: background 0.1s; font-size: 13px; font-weight: 500; color: #37352F; }
  .list-item-f:hover { background: #e1e1e1; }
  .list-item-f.active { background: #fff; border-left: 3px solid #2383E2; font-weight: 600; }
  
  /* Indicateur de modif */
  .save-btn-dirty { background-color: #37352F !important; color: white !important; border-color: #37352F !important; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
  .unsaved-dot { width: 8px; height: 8px; background: #EB5757; border-radius: 50%; display: inline-block; margin-right: 6px; opacity: 0; transition: opacity 0.2s; }
  .is-dirty .unsaved-dot { opacity: 1; }
</style>

<div class="fanekena-container row g-0">
    
    <!-- LISTE GAUCHE (Visible par défaut sur mobile, col-3 sur desktop) -->
    <div id="fnk-panel-list" class="col-12 col-md-3 fanekena-list-panel">
        <div class="p-3 border-bottom d-flex justify-content-between align-items-center">
            <span class="fw-bold small text-secondary" style="letter-spacing:1px;">CONFESSIONS</span>
            <button class="btn btn-sm btn-link text-dark p-0" onclick="handleFnkNavigation('NEW')"><i class="bi bi-plus-lg"></i></button>
        </div>
        <div id="fanekenaListContainer" class="flex-grow-1 overflow-auto custom-scrollbar">
            <div class="text-center py-4 text-muted"><div class="spinner-border spinner-border-sm"></div></div>
        </div>
    </div>

    <!-- EDITEUR DROIT (Caché sur mobile par défaut, col-9 sur desktop) -->
    <div id="fnk-panel-editor" class="col-12 col-md-9 fanekena-editor-panel d-none d-md-flex">
        
        <!-- Header Fixe -->
        <div class="px-4 pt-3 pb-2 border-bottom sticky-top bg-white" style="z-index: 10;">
            <div class="d-flex justify-content-between align-items-center">
                
                <div class="d-flex align-items-center flex-grow-1 me-3">
                    <!-- Bouton Retour Mobile -->
                    <button class="btn btn-link text-dark p-0 me-3 d-md-none" onclick="handleFnkNavigation('BACK_LIST')">
                        <i class="bi bi-arrow-left fs-4"></i>
                    </button>
                    
                    <span class="unsaved-dot" title="Modifications non enregistrées"></span>
                    <input type="text" id="editFnkTitre" 
                           class="form-control border-0 p-0 fs-4 fw-bold text-dark" 
                           placeholder="Titre (ex: Symbole des Apôtres)..." 
                           style="background:transparent;"
                           oninput="markFnkDirty()">
                </div>

                <div class="d-flex gap-2 align-items-center">
                    <input type="hidden" id="editFnkId"><input type="hidden" id="editFnkRow">
                    <!-- Boutons visibles uniquement si éditeur actif -->
                    <div id="editorActions" class="d-none d-flex gap-2">
                        <button class="btn btn-sm btn-light border text-danger" onclick="deleteFanekena()"><i class="bi bi-trash"></i></button>
                        <button id="btnSaveFnk" class="btn btn-sm btn-primary-notion transition-all" onclick="saveFanekena()">Enregistrer</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex-grow-1 overflow-auto custom-scrollbar p-4" id="fanekenaScrollArea">
            
            <div id="editorContent" class="d-none">
                <div class="row g-4">
                    <div class="col-md-6">
                        <label class="small fw-bold text-muted mb-2">MALGACHE</label>
                        <textarea id="editFnkMG" 
                                  class="form-control doc-input bg-light p-3" 
                                  style="resize:none; overflow:hidden; min-height: 150px; font-size: 12px; line-height: 1.6; padding-bottom: 15px !important; text-align: justify;" 
                                  placeholder="Texte malgache..."
                                  oninput="autoResize(this); markFnkDirty()"></textarea>
                    </div>
                    <div class="col-md-6">
                        <label class="small fw-bold text-muted mb-2">FRANÇAIS</label>
                        <textarea id="editFnkFR" 
                                  class="form-control doc-input bg-light p-3 text-secondary" 
                                  style="resize:none; overflow:hidden; min-height: 150px; font-size: 12px; line-height: 1.6; padding-bottom: 15px !important; text-align: justify;" 
                                  placeholder="Texte français..."
                                  oninput="autoResize(this); markFnkDirty()"></textarea>
                    </div>
                </div>
                <div style="height: 100px;"></div>
            </div>
            
            <div id="emptyStateFnk" class="h-100 d-flex align-items-center justify-content-center text-muted small fst-italic">
                <div class="text-center opacity-50">
                    <i class="bi bi-journal-text display-4 mb-2 d-block"></i>
                    Sélectionnez ou créez un texte à gauche.
                </div>
            </div>

        </div>
    </div>
</div>

<!-- MODAL DISCARD CHANGES -->
<div id="discardChangesModal" class="notion-dialog" style="display:none; width: 320px; padding: 20px;">
    <div class="mb-3">
        <h6 class="fw-bold m-0 text-dark">Modifications non enregistrées</h6>
        <p class="small text-muted mt-2 mb-0" style="line-height:1.4;">
            Vous avez des modifications en cours. Si vous quittez, elles seront perdues.
        </p>
    </div>
    <div class="d-flex justify-content-end gap-2">
        <button class="btn btn-sm btn-light border" onclick="cancelFnkNavigation()">Annuler</button>
        <button class="btn btn-sm btn-danger text-white" onclick="confirmFnkDiscard()">Quitter sans sauver</button>
    </div>
</div>
<div id="fnkOverlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.2); z-index:1090;" onclick="cancelFnkNavigation()"></div>