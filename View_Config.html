<style>
  /* CONFIG LAYOUT RESPONSIVE */
  .cfg-container { padding: 20px; height: 100%; display: flex; flex-direction: column; background: #fff; }
  
  .cfg-header-bar { 
      display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;
      margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #e1e1e1;
  }
  
  /* LOCK STATE */
  .is-locked .cfg-input, .is-locked .cfg-select { 
      pointer-events: none; opacity: 0.7; color: #666; 
  }
  .is-locked .btn-add, .is-locked .btn-delete, .is-locked .pass-toggle { display: none !important; }
  .is-locked .cfg-card { background: #fafafa; border-color: #eee; }
  
  /* RESPONSIVE GRID (Auto-fit : 1, 2 ou 3 colonnes selon écran) */
  .cfg-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
      gap: 20px; 
      flex-grow: 1; 
      overflow-y: auto; padding-bottom: 20px;
  }
  
  /* CARDS (Notion Style) */
  .cfg-card {
      background: white; border: 1px solid #e1e1e1; border-radius: 6px;
      display: flex; flex-direction: column; overflow: hidden;
      box-shadow: 0 1px 3px rgba(0,0,0,0.02);
      transition: all 0.2s;
  }
  .cfg-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.05); }

  .cfg-card-head { 
      padding: 10px 14px; background: #fff; border-bottom: 1px solid #f0f0f0;
      font-weight: 600; color: #999; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px;
      display: flex; justify-content: space-between; align-items: center;
  }
  .cfg-card-body { flex-grow: 1; overflow-y: auto; padding: 10px; }
  
  /* ITEMS */
  .cfg-item { 
      display: flex; align-items: center; gap: 8px; padding: 4px 8px; 
      background: white; border-radius: 4px; margin-bottom: 2px;
      transition: background 0.1s;
  }
  .cfg-item:hover { background: #f7f7f5; }
  
  .cfg-input { 
      border: none; background: transparent; width: 100%; font-size: 13px; color: #37352F;
      outline: none; padding: 4px 0;
  }
  .cfg-input::placeholder { color: #d3d3d3; }
  
  .code-badge { font-family: 'Consolas', monospace; background: #f0f0f0; padding: 2px 6px; border-radius: 4px; font-size: 12px; letter-spacing: 1px; }
  
  /* Password Wrapper */
  .pass-wrapper {
      display: flex; align-items: center; background: #fff; border: 1px solid #e1e1e1; 
      border-radius: 4px; padding: 4px 8px; transition: border-color 0.2s;
  }
  .pass-wrapper:focus-within { border-color: #2383E2; box-shadow: 0 0 0 2px rgba(35, 131, 226, 0.1); }
  
  /* Boutons */
  .btn-icon-hover { opacity: 0.5; transition: opacity 0.2s; cursor: pointer; }
  .btn-icon-hover:hover { opacity: 1; }

  /* Mobile Tweaks */
  @media (max-width: 600px) {
      .cfg-container { padding: 10px; }
      .cfg-grid { grid-template-columns: 1fr; } 
  }
</style>

<div class="cfg-container" id="configViewRoot">
    
    <div class="cfg-header-bar">
        <div>
            <h5 class="m-0 fw-bold text-dark"><i class="bi bi-sliders2 me-2"></i>Administration</h5>
            <div class="small mt-1" id="lockStatusText" style="font-size: 11px; color: #999;">
                <i class="bi bi-lock-fill me-1"></i>LECTURE SEULE
            </div>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-sm btn-outline-danger hidden shadow-sm" id="btnLock" onclick="toggleAdminMode(false)">
                <i class="bi bi-lock-fill me-1"></i>Verrouiller
            </button>
            <button class="btn btn-sm btn-dark shadow-sm" id="btnUnlock" onclick="askAdminCode()">
                <i class="bi bi-unlock-fill me-1"></i>Mode Admin
            </button>
            <button class="btn btn-sm btn-primary-notion hidden shadow-sm" id="btnSaveAll" onclick="saveAllConfig()">
                <i class="bi bi-cloud-arrow-up-fill me-1"></i>Enregistrer
            </button>
        </div>
    </div>

    <div class="cfg-grid is-locked" id="configGrid">
        
        <div class="cfg-card">
            <div class="cfg-card-head">
                <span>Rôles & Types</span>
                <i class="bi bi-plus-lg btn-add btn-icon-hover" onclick="addRole()"></i>
            </div>
            <div class="cfg-card-body custom-scrollbar" id="rolesContainer"></div>
        </div>

        <div class="cfg-card">
            <div class="cfg-card-head">
                <span>Base Participants</span>
                <i class="bi bi-plus-lg btn-add btn-icon-hover" onclick="addNom()"></i>
            </div>
            <div class="cfg-card-body custom-scrollbar" id="nomsContainer"></div>
        </div>

        <div class="cfg-card" style="border-top: 3px solid #EB5757;">
            <div class="cfg-card-head text-danger">
                <span><i class="bi bi-shield-lock me-2"></i>Sécurité</span>
            </div>
            <div class="cfg-card-body custom-scrollbar">
                
                <div class="mb-4">
                    <label class="small fw-bold text-muted mb-2" style="font-size:10px;">MOT DE PASSE "RESPONSABLE"</label>
                    <div class="pass-wrapper">
                        <i class="bi bi-key text-secondary me-2 small"></i>
                        <input type="password" id="respCodeInput" class="cfg-input fw-bold text-dark" placeholder="Définir un code...">
                        <i class="bi bi-eye-slash pass-toggle btn-icon-hover ms-2" onclick="togglePassVisibility(this, 'respCodeInput')"></i>
                    </div>
                    <div class="mt-1 text-muted" style="font-size:10px; line-height:1.2;">
                        Code unique partagé à l'équipe (Louange, Tech...) pour l'édition simple.
                    </div>
                </div>

                <hr class="opacity-10 my-3">

                <div class="d-flex justify-content-between align-items-center mb-2 px-1">
                    <span class="small fw-bold text-muted" style="font-size:10px;">LISTE DES VALIDEURS</span>
                    <i class="bi bi-person-plus-fill btn-add btn-icon-hover text-danger" onclick="addValideur()"></i>
                </div>
                <div id="valideursContainer"></div>

            </div>
        </div>

    </div>
</div>

<div id="adminAuthModal" class="notion-dialog" style="display:none; width: 300px; padding: 24px;">
    <div class="text-center mb-3">
        <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width:40px; height:40px;">
            <i class="bi bi-shield-lock-fill text-dark fs-5"></i>
        </div>
        <h6 class="fw-bold m-0">Accès Administrateur</h6>
    </div>
    <input type="password" id="adminCodeInput" class="form-control text-center fw-bold letter-spacing-2 mb-3 shadow-sm" placeholder="••••">
    <div class="d-grid gap-2">
        <button class="btn btn-dark btn-sm" onclick="submitAdminAuth()">Déverrouiller</button>
        <button class="btn btn-link btn-sm text-secondary text-decoration-none" onclick="closeAdminModal()">Annuler</button>
    </div>
</div>
<div id="configOverlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:1050; backdrop-filter: blur(2px);" onclick="closeAdminModal()"></div>