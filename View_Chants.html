<div class="toast-container position-fixed bottom-0 start-50 translate-middle-x p-3" style="z-index: 1060;">
  <div id="liveToast" class="toast align-items-center text-white bg-dark border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body" id="toastMessage">
        Action effectuée !
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
</div>

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h2 class="mb-1">Bibliothèque des chants</h2>
    <div class="text-secondary small">Gérez le répertoire de l'église</div>
  </div>
  <button class="btn btn-primary-notion" onclick="openChantModal()">
    <i class="bi bi-plus-lg"></i> Ajouter un chant
  </button>
</div>

<div class="d-flex gap-2 mb-4">
  <div class="input-group flex-grow-1" style="box-shadow: 0 1px 3px rgba(0,0,0,0.05); border-radius: 6px;">
    <span class="input-group-text bg-white border-end-0 ps-3"><i class="bi bi-search text-secondary"></i></span>
    <input type="text" id="chantSearchInput" class="form-control border-start-0 border-end-0 py-2" 
           placeholder="Rechercher un chant..." onkeyup="handleSearchInput()">
    <span class="input-group-text bg-white border-start-0 pe-3">
      <div id="searchSpinner" class="spinner-border spinner-border-sm text-primary hidden" role="status"></div>
    </span>
  </div>
</div>

<div id="mainChantView">
  
  <div id="searchResultsContainer" class="list-group list-group-flush border rounded-3 bg-white hidden"></div>

  <div id="accordionContainer" class="accordion accordion-flush border rounded-3 bg-white">
    
    <div class="accordion-item">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed fw-bold text-secondary" type="button" onclick="toggleRecueil(this, 'Fihirana')">
          <i class="bi bi-book me-2 text-primary"></i> Fihirana
        </button>
      </h2>
      <div id="collapse-Fihirana" class="accordion-collapse collapse">
        <div class="accordion-body p-0 list-group list-group-flush" id="list-Fihirana">
          <div class="p-3 text-center text-muted"><div class="spinner-border spinner-border-sm"></div> Chargement...</div>
        </div>
      </div>
    </div>

    <div class="accordion-item">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed fw-bold text-secondary" type="button" onclick="toggleRecueil(this, 'Fihirana Fanampiny')">
          <i class="bi bi-journal-text me-2 text-success"></i> Fihirana Fanampiny
        </button>
      </h2>
      <div id="collapse-Fihirana Fanampiny" class="accordion-collapse collapse">
        <div class="accordion-body p-0 list-group list-group-flush" id="list-Fihirana Fanampiny">
           <div class="p-3 text-center text-muted"><div class="spinner-border spinner-border-sm"></div> Chargement...</div>
        </div>
      </div>
    </div>

    <div class="accordion-item">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed fw-bold text-secondary" type="button" onclick="toggleRecueil(this, 'Antema')">
          <i class="bi bi-bookmarks me-2 text-warning"></i> Antema
        </button>
      </h2>
      <div id="collapse-Antema" class="accordion-collapse collapse">
        <div class="accordion-body p-0 list-group list-group-flush" id="list-Antema">
           <div class="p-3 text-center text-muted"><div class="spinner-border spinner-border-sm"></div> Chargement...</div>
        </div>
      </div>
    </div>

  </div>
</div>


<div class="modal fade" id="modalEditChant" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content" style="border-radius: 3px; box-shadow: 0 8px 30px rgba(0,0,0,0.12); border: 1px solid #e1e1e1;">
      
      <div id="modalLoader" class="hidden" style="position: absolute; inset: 0; background: rgba(255,255,255,0.9); z-index: 10; display: flex; align-items: center; justify-content: center;">
        <div class="spinner-border text-secondary" role="status"></div>
      </div>

      <div class="modal-header border-0 pb-0 pt-4 px-4">
        <h5 class="modal-title fw-bold text-dark" id="modalTitle">Nouveau chant</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body px-4 pt-2">
        <form id="formChantEditor">
          <input type="hidden" id="editRowIndex">

          <div class="py-2" style="font-size: 14px;">
            <div class="row g-2">
              <div class="col-4">
                <label class="small text-secondary fw-bold">RECUEIL</label>
                <select class="form-select form-select-sm bg-light border-0" id="editRecueil"></select>
              </div>
              <div class="col-2">
                 <label class="small text-secondary fw-bold">N°</label>
                 <input type="number" class="form-control form-control-sm bg-light border-0 fw-bold" id="editNumero">
              </div>
              <div class="col-2"> <label class="small text-secondary fw-bold">TONALITÉ</label>
                 <input type="text" class="form-control form-control-sm bg-light border-0 fw-bold" id="editTonalite" placeholder="Ex: G">
              </div>
               <div class="col-4">
                 <label class="small text-secondary fw-bold">TAGS</label>
                 <input type="text" class="form-control form-control-sm bg-light border-0" id="editTags" placeholder="Noël...">
              </div>
            </div>
          </div>

          <hr class="text-secondary opacity-25 my-3">
          <input type="text" class="form-control border-0 px-0 mb-4" id="editTitre" placeholder="Titre du chant" style="font-size: 24px; font-weight: 700;">

          <div id="editorStrophesContainer" class="d-flex flex-column gap-3 mb-4"></div>

          <div class="text-center text-muted small fst-italic py-2" id="emptyStropheMsg">
            Ajoutez des paroles ci-dessous.
          </div>

          <div class="d-flex gap-2 justify-content-center pt-3 border-top border-dashed">
            <button type="button" class="btn btn-outline-primary btn-sm px-3" onclick="addStropheBlock('C')">
              <i class="bi bi-plus-lg"></i> Couplet
            </button>
            <button type="button" class="btn btn-outline-success btn-sm px-3" onclick="addStropheBlock('R')">
              <i class="bi bi-plus-lg"></i> Refrain
            </button>
          </div>

        </form>
      </div>

      <div class="modal-footer border-0 bg-light">
        <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-dismiss="modal">Fermer</button>
        <button type="button" class="btn btn-sm btn-dark px-4" onclick="submitChantSave()">Enregistrer</button>
      </div>
    </div>
  </div>
</div>