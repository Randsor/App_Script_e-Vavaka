<div class="row h-100 g-0">
  <div id="panel-list" class="col-12 col-md-2 border-end bg-light" style="background-color: #F7F7F5 !important;">
    <div class="p-3 border-bottom d-flex justify-content-between align-items-center">
      <span class="fw-bold text-secondary small" style="letter-spacing: 1px;">MODÈLES</span>
      <button class="btn btn-sm btn-link text-dark p-0" onclick="createNewTemplate()" title="Nouveau">
        <i class="bi bi-plus-lg"></i>
      </button>
    </div>
    <div id="templatesList" class="list-group list-group-flush overflow-auto" style="height: calc(100vh - 60px);">
      <div class="p-4 text-center text-muted"><div class="spinner-border spinner-border-sm"></div></div>
    </div>
  </div>

  <div id="panel-editor" class="col-12 col-md-10 d-flex flex-column h-100 bg-white" style="display:none !important;">
    <div class="px-4 py-2 d-flex justify-content-between align-items-center bg-white sticky-top border-bottom" style="z-index: 50;">
      <button class="btn btn-link text-dark p-0 me-3 d-md-none" onclick="showMobileList()"><i class="bi bi-arrow-left fs-4"></i></button>
      <div class="flex-grow-1 me-3">
         <div class="input-group input-group-sm">
            <span class="input-group-text border-0 bg-transparent text-muted small px-0">Fichier :</span>
            <input type="text" id="tplName" class="form-control border-0 fw-bold text-dark shadow-none bg-transparent" placeholder="Nom pour l'admin...">
         </div>
      </div>
      <div class="d-flex align-items-center">
        <input type="hidden" id="tplRowIndex"><input type="hidden" id="tplId">
        <div class="text-secondary small me-3 fst-italic" id="saveStatus"></div>
        <button class="btn btn-sm btn-link text-danger text-decoration-none me-2" onclick="deleteCurrentTemplate()"><i class="bi bi-trash"></i></button>
        <button class="btn btn-sm btn-primary-notion" onclick="saveTemplate()">Sauvegarder</button>
      </div>
    </div>

    <div class="flex-grow-1 px-5 py-4 overflow-auto custom-scrollbar">
      
      <!-- INJECTION DU HEADER PARTAGÉ -->
      <!-- Le code HTML est dans Component_LiturgyHeader.html mais le script peut le déplacer ici si besoin. 
           Comme il est inclus dans Index, il est dans le flux. 
           Pour simplifier, on va utiliser la structure du Component directement via JS ou inclusion.
           ATTENTION : Comme Component_LiturgyHeader.html est inclus dans le Body global, 
           on doit le déplacer ici dynamiquement quand la vue est active, OU on l'inclus directement ici.
           Pour éviter les doublons d'ID, on ne l'inclus pas deux fois.
           ASTUCE : On va laisser un conteneur vide ici et déplacer le contenu du Component dedans via JS.
      -->
      <div id="templateHeaderPlaceholder"></div>

      <div id="blocksContainer" class="d-flex flex-column pb-2 w-100 mx-auto" style="max-width: 900px;"></div>
      
      <div class="text-muted mt-2 p-5 text-center hidden" id="emptyTplMsg"><i class="bi bi-plus-circle display-4 opacity-25 mb-3 d-block"></i>Commencez à écrire votre liturgie en ajoutant un bloc ci-dessous.</div>
      <div class="add-zone-final p-3 text-secondary opacity-50 hover-opacity-100 cursor-pointer text-center mx-auto" style="max-width: 900px;" onclick="openInsertMenu(-1, this)"><i class="bi bi-plus-lg me-2"></i>Ajouter un bloc</div>
      <div style="height: 150px;"></div>
    </div>
  </div>
  <div class="col-md-10 d-none d-md-flex align-items-center justify-content-center text-muted bg-white" id="emptyStatePanel"><div class="text-center opacity-50"><i class="bi bi-file-earmark-text display-1 mb-3"></i><p>Sélectionnez un modèle à gauche.</p></div></div>
</div>

<div id="menuOverlay" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:1040; cursor:default;"></div>

<div id="insertMenu" class="dropdown-menu custom-popup" style="display:none; position:absolute; z-index:1050; width: 180px;">
  <h6 class="dropdown-header">STRUCTURE</h6>
  <button class="dropdown-item" onclick="insertBlock('TITRE')">Titre de section</button>
  <div class="dropdown-divider my-1 opacity-50"></div>
  <h6 class="dropdown-header">CONTENU</h6>
  <button class="dropdown-item" onclick="insertBlock('CHANT')">Chant / Hira</button>
  <button class="dropdown-item" onclick="insertBlock('LECTURE')">Lecture Biblique</button>
  <button class="dropdown-item" onclick="insertBlock('LITURGIE')">Texte Liturgique</button>
  <button class="dropdown-item" onclick="insertBlock('PREDICATION')">Prédication</button>
  <button class="dropdown-item" onclick="insertBlock('PRIERE')">Prière</button>
  <button class="dropdown-item" onclick="insertBlock('ANNONCE')">Annonces</button>
  <button class="dropdown-item" onclick="insertBlock('LIBRE')">Section libre</button>
  <button class="dropdown-item" onclick="insertBlock('TEXTE_LIBRE')">Texte libre</button>
</div>

<div id="roleMenu" class="dropdown-menu custom-popup" style="display:none; position:absolute; z-index:1050; width: 180px;"></div>